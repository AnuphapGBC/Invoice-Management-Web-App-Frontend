(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{15:function(e,t,a){e.exports=a(31)},21:function(e,t,a){},22:function(e,t,a){},27:function(e,t,a){},28:function(e,t,a){},29:function(e,t,a){},30:function(e,t,a){},31:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),c=a(14),r=a.n(c),o=(a(21),a(6)),s=a(2),i=a(32);a(22);var u=e=>{let{setUser:t}=e;const[a,c]=Object(n.useState)(""),[r,o]=Object(n.useState)(""),u=Object(s.q)();return l.a.createElement("div",{className:"login-container"},l.a.createElement("div",{className:"login-card"},l.a.createElement("h2",null,"Login"),l.a.createElement("form",{onSubmit:async e=>{e.preventDefault();try{const e=await i.a.post("http://localhost:5001/api/login",{username:a,password:r});e.data.success?(localStorage.setItem("user",JSON.stringify(e.data.user)),t(e.data.user),u("/invoices")):alert("Login failed. Please check your credentials.")}catch(n){console.error("Login Error:",n),alert("Login failed. Please check your credentials.")}}},l.a.createElement("input",{type:"text",value:a,onChange:e=>c(e.target.value),placeholder:"Username",required:!0}),l.a.createElement("input",{type:"password",value:r,onChange:e=>o(e.target.value),placeholder:"Password",required:!0}),l.a.createElement("button",{type:"submit"},"Login"))))};const m=Object(n.createContext)();a(27);var d=e=>{let{invoice:t,onSave:a,onClose:c,receiptTypes:r}=e;const[o,s]=Object(n.useState)(t||{invoiceNumber:"",receiptNumber:"",date:"",time:"",receiptType:"",narrative:"",amount:"",currency:"",images:[],existingImages:[],targetCurrency:"",conversionRate:1,convertedAmount:""}),[u,m]=Object(n.useState)(null),[d,p]=Object(n.useState)(null),v=["USD","EUR","GBP","CAD","AUD","JPY","CHF","CNY","INR","BRL","MXN","SEK","NOK","DKK","ZAR","SGD","HKD","NZD","KRW","TRY","RUB","AED"];Object(n.useEffect)(()=>{(async()=>{if(t)try{const a=await i.a.get(`http://localhost:5001/api/invoices/${t.id}/images`);a.data&&a.data.images&&s(e=>({...e,existingImages:a.data.images,time:t.time?t.time.substring(0,5):""}))}catch(e){console.error(`Failed to fetch images for invoice ${t.id}`,e)}})()},[t]);const E=e=>{const{name:t,value:a}=e.target;"time"===t?s({...o,[t]:`${a}:00`}):(s({...o,[t]:a}),"amount"!==t&&"conversionRate"!==t&&"targetCurrency"!==t||y({...o,[t]:a}))},y=e=>{const{amount:t,conversionRate:a,targetCurrency:n}=e;if(t&&a&&n){const e=(t*a).toFixed(2);s(t=>({...t,convertedAmount:e}))}else s(e=>({...e,convertedAmount:""}))},b=e=>{e.stopPropagation(),m(null)};return l.a.createElement("div",{className:"popup-overlay fancy-popup"},l.a.createElement("div",{className:"popup fancy-popup-window"},l.a.createElement("h3",null,t?"Edit Invoice":"Add Invoice"),l.a.createElement("input",{type:"text",name:"invoiceNumber",placeholder:"Invoice Number",value:o.invoiceNumber,onChange:E}),l.a.createElement("input",{type:"text",name:"receiptNumber",placeholder:"Receipt Number",value:o.receiptNumber,onChange:E}),l.a.createElement("input",{type:"date",name:"date",placeholder:"Date",value:o.date,onChange:E}),l.a.createElement("input",{type:"time",name:"time",placeholder:"Time",value:o.time.substring(0,5),onChange:E}),l.a.createElement("select",{name:"receiptType",value:o.receiptType,onChange:E},l.a.createElement("option",{value:""},"Select Receipt Type"),r.map((e,t)=>l.a.createElement("option",{key:t,value:e},e))),l.a.createElement("textarea",{name:"narrative",placeholder:"Narrative",value:o.narrative,onChange:E}),l.a.createElement("input",{type:"number",name:"amount",placeholder:"Amount",value:o.amount,onChange:E}),l.a.createElement("select",{name:"currency",value:o.currency,onChange:E},l.a.createElement("option",{value:""},"Select Currency"),v.map((e,t)=>l.a.createElement("option",{key:t,value:e},e))),l.a.createElement("select",{name:"targetCurrency",value:o.targetCurrency,onChange:E},l.a.createElement("option",{value:""},"Select Target Currency"),v.map((e,t)=>l.a.createElement("option",{key:t,value:e},e))),l.a.createElement("input",{type:"number",name:"conversionRate",placeholder:"Conversion Rate",value:o.conversionRate,onChange:e=>{E(e),y({...o,conversionRate:e.target.value})}}),l.a.createElement("input",{type:"text",name:"convertedAmount",placeholder:"Converted Amount",value:o.convertedAmount,readOnly:!0}),Array.isArray(o.existingImages)&&o.existingImages.length>0&&l.a.createElement("div",{className:"existing-images"},l.a.createElement("h4",null,"Existing Images"),l.a.createElement("div",{className:"existing-images-list"},o.existingImages.map((e,t)=>l.a.createElement("div",{key:t,className:"existing-image-item"},l.a.createElement("img",{src:`http://localhost:5001/${e.imageUrl}`,alt:`Invoice ${o.invoiceNumber} Image ${t+1}`,className:"invoice-image-thumbnail",onClick:()=>(e=>{m(e)})(e.imageUrl)}))))),l.a.createElement("input",{type:"file",name:"images",multiple:!0,onChange:e=>{const t=Array.from(e.target.files);s({...o,images:t})},accept:"image/*"}),l.a.createElement("div",{className:"popup-buttons"},l.a.createElement("button",{onClick:()=>{a(o),alert(t?"Invoice updated successfully!":"Invoice added successfully!"),window.location.reload()},className:"fancy-button"},t?"Update Invoice":"Add Invoice"),l.a.createElement("button",{onClick:c,className:"fancy-button cancel-button"},"Cancel"))),u&&l.a.createElement("div",{className:"full-screen-overlay",onClick:b},l.a.createElement("div",{className:"full-screen-image-container"},l.a.createElement("img",{src:`http://localhost:5001/${u}`,alt:"Full Screen",className:"full-screen-image"}),l.a.createElement("button",{type:"button",className:"close-full-screen-button fancy-button",onClick:b},"Close"))))};a(28);var p=()=>{const[e,t]=Object(n.useState)([]),{user:a}=Object(n.useContext)(m),[c,r]=Object(n.useState)(""),[o,s]=Object(n.useState)(!1),[u,p]=Object(n.useState)(!1),[v,E]=Object(n.useState)(""),[y,b]=Object(n.useState)(null),[h,g]=Object(n.useState)(""),[f]=Object(n.useState)(["Invoice","Gas","Support Office","Other"]);Object(n.useEffect)(()=>{(async()=>{try{const a=await i.a.get("http://localhost:5001/api/invoices");if(a.data&&Array.isArray(a.data.invoices)){const e=a.data.invoices.map(e=>({...e,date:e.date.split("T")[0]}));t(e)}else console.error("Unexpected response format",a.data),t([])}catch(e){console.error("Failed to fetch invoices",e)}})(),(async()=>{if(null===a||void 0===a?void 0:a.username)try{const t=await i.a.get(`http://localhost:5001/api/users/username/${a.username}`);t.data&&t.data.user?r(t.data.user.email):console.error("User email not found")}catch(e){console.error("Failed to fetch user email",e)}})()},[a]);return l.a.createElement("div",{className:"invoice-container"},l.a.createElement("h2",null,"Invoices"),l.a.createElement("button",{className:"add-invoice-button fancy-button",onClick:()=>{E("add"),s(!0)}},"Add Invoice"),o&&l.a.createElement(d,{invoice:"edit"===v?y:null,onSave:"add"===v?async e=>{try{const n=new FormData;for(const t in e)"images"===t&&e.images.length>0?e.images.forEach(e=>n.append("images",e)):n.append(t,e[t]);n.append("createdBy",(null===a||void 0===a?void 0:a.username)||(null===a||void 0===a?void 0:a.id)||"Unknown");const l=await i.a.post("http://localhost:5001/api/invoices",n,{headers:{"Content-Type":"multipart/form-data"}});l.data&&l.data.success&&(alert("Invoice added successfully!"),window.location.reload())}catch(t){console.error("Failed to add invoice",t)}}:async e=>{try{const n=new FormData;for(const t in e)"images"===t&&e.images.length>0?e.images.forEach(e=>n.append("images",e)):n.append(t,e[t]);e.createdBy||n.append("createdBy",(null===a||void 0===a?void 0:a.username)||(null===a||void 0===a?void 0:a.id)||"Unknown");const l=await i.a.put(`http://localhost:5001/api/invoices/${e.id}`,n,{headers:{"Content-Type":"multipart/form-data"}});l.data&&l.data.success&&(alert("Invoice updated successfully!"),window.location.reload())}catch(t){console.error("Failed to update invoice",t)}},onClose:()=>s(!1),receiptTypes:f}),u&&l.a.createElement("div",{className:"popup-overlay fancy-popup"},l.a.createElement("div",{className:"popup fancy-popup-window"},l.a.createElement("h3",null,"Send Invoice Email"),l.a.createElement("input",{type:"email",name:"recipientEmail",placeholder:"Recipient Email",value:h,onChange:e=>g(e.target.value)}),l.a.createElement("div",{className:"popup-buttons"},l.a.createElement("button",{onClick:async()=>{console.log("Email from:",c);try{if(!c)return console.error("User email is missing. Cannot send email."),void alert("Failed to send email. User email is missing.");const t={from:c,to:h,subject:`Summary Receipt Number (${y.receiptNumber}) and Invoice Number (${y.invoiceNumber})`,body:`Here are the details of the invoice:\n\nReceipt Number: ${y.receiptNumber}\nInvoice Number: ${y.invoiceNumber}\nDate: ${y.date}\nTime: ${y.time}\nReceipt Type: ${y.receiptType}\nNarrative: ${y.narrative}\nAmount: ${y.amount}\nCurrency: ${y.currency}`,invoiceId:y.id};console.log("Sending email with payload:",t);const a=await i.a.post("http://localhost:5001/api/send-mail",t);a.data&&a.data.success?(alert("Email sent successfully!"),p(!1)):alert("Failed to send email.")}catch(e){console.error("Failed to send email",e),alert("An error occurred while sending the email.")}},className:"fancy-button"},"Send Email"),l.a.createElement("button",{onClick:()=>p(!1),className:"fancy-button cancel-button"},"Cancel")))),l.a.createElement("table",{className:"invoice-table fancy-table"},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"Invoice Number"),l.a.createElement("th",null,"Receipt Number"),l.a.createElement("th",null,"Date"),l.a.createElement("th",null,"Time"),l.a.createElement("th",null,"Receipt Type"),l.a.createElement("th",null,"Narrative"),l.a.createElement("th",null,"Amount"),l.a.createElement("th",null,"Currency"),l.a.createElement("th",null,"Actions"))),l.a.createElement("tbody",null,e.map(e=>l.a.createElement("tr",{key:e.id,className:"fancy-table-row"},l.a.createElement("td",null,e.invoiceNumber),l.a.createElement("td",null,e.receiptNumber),l.a.createElement("td",null,e.date),l.a.createElement("td",null,e.time),l.a.createElement("td",null,e.receiptType),l.a.createElement("td",null,e.narrative),l.a.createElement("td",null,e.amount),l.a.createElement("td",null,e.currency),l.a.createElement("td",null,"viewer"!==(null===a||void 0===a?void 0:a.role)&&l.a.createElement("div",{className:"action-buttons"},l.a.createElement("button",{className:"fancy-button edit-button",onClick:()=>(e=>{b(e),E("edit"),s(!0)})(e)},"Edit"),l.a.createElement("button",{className:"fancy-button delete-button",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this invoice?"))try{const a=await i.a.delete(`http://localhost:5001/api/invoices/${e}`);a.data&&a.data.success&&(alert("Invoice deleted successfully!"),window.location.reload())}catch(t){console.error("Failed to delete invoice",t)}})(e.id)},"Delete"),l.a.createElement("button",{className:"fancy-button mail-button",onClick:()=>(e=>{b(e),E("send"),p(!0)})(e)},"Send Mail"))))))))};a(29);var v=()=>{const[e,t]=Object(n.useState)([]),[a,c]=Object(n.useState)(!1),[r,o]=Object(n.useState)(""),[s,u]=Object(n.useState)(null),[m,d]=Object(n.useState)({username:"",email:"",password:"",role:"viewer"});Object(n.useEffect)(()=>{(async()=>{try{const a=await i.a.get("http://localhost:5001/api/users");a.data&&Array.isArray(a.data.users)?t(a.data.users):(console.error("Unexpected response format",a.data),t([]))}catch(e){console.error("Failed to fetch users",e)}})()},[]);const p=e=>{const{name:t,value:a}=e.target;d({...m,[t]:a})};return l.a.createElement("div",{className:"user-container"},l.a.createElement("h2",null,"Users"),l.a.createElement("button",{className:"add-user-button fancy-button",onClick:()=>{o("add"),c(!0)}},"Add User"),a&&l.a.createElement("div",{className:"popup-overlay fancy-popup"},l.a.createElement("div",{className:"popup fancy-popup-window"},l.a.createElement("h3",null,"add"===r?"Add User":"Edit User"),l.a.createElement("input",{type:"text",name:"username",placeholder:"Username",value:m.username,onChange:p}),l.a.createElement("input",{type:"email",name:"email",placeholder:"Email",value:m.email,onChange:p}),"add"===r&&l.a.createElement("input",{type:"password",name:"password",placeholder:"Password",value:m.password,onChange:p}),l.a.createElement("select",{name:"role",value:m.role,onChange:p,className:"role-dropdown"},l.a.createElement("option",{value:"admin"},"Admin"),l.a.createElement("option",{value:"editor"},"Editor"),l.a.createElement("option",{value:"viewer"},"Viewer")),l.a.createElement("div",{className:"popup-buttons"},l.a.createElement("button",{onClick:()=>{"add"===r?(async()=>{try{const t=await i.a.post("http://localhost:5001/api/users",m);t.data&&t.data.success&&(alert("User added successfully!"),window.location.reload())}catch(e){console.error("Failed to add user",e)}})():"edit"===r&&(async()=>{try{const t=await i.a.put(`http://localhost:5001/api/users/${s.id}`,m);t.data&&t.data.success&&(alert("User updated successfully!"),window.location.reload())}catch(e){console.error("Failed to update user",e)}})()},className:"fancy-button"},"add"===r?"Add User":"Update User"),l.a.createElement("button",{onClick:()=>c(!1),className:"fancy-button cancel-button"},"Cancel")))),l.a.createElement("table",{className:"user-table fancy-table"},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",null,"Username"),l.a.createElement("th",null,"Email"),l.a.createElement("th",null,"Role"),l.a.createElement("th",null,"Actions"))),l.a.createElement("tbody",null,e.map(e=>l.a.createElement("tr",{key:e.id,className:"fancy-table-row"},l.a.createElement("td",null,e.username),l.a.createElement("td",null,e.email),l.a.createElement("td",null,e.role),l.a.createElement("td",null,l.a.createElement("div",{className:"action-buttons"},l.a.createElement("button",{className:"fancy-button edit-button",onClick:()=>(e=>{u(e),d({username:e.username,email:e.email,password:"",role:e.role}),o("edit"),c(!0)})(e)},"Edit"),l.a.createElement("button",{className:"fancy-button delete-button",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this user?"))try{const a=await i.a.delete(`http://localhost:5001/api/users/${e}`);a.data&&a.data.success&&(alert("User deleted successfully!"),window.location.reload())}catch(t){console.error("Failed to delete user",t)}})(e.id)},"Delete"))))))))};var E=e=>{let{allowedRoles:t,children:a}=e;const{user:c}=Object(n.useContext)(m);return c?t&&!t.includes(c.role)?l.a.createElement(s.a,{to:"/"}):a:l.a.createElement(s.a,{to:"/"})};a(30);var y=()=>{const{user:e,setUser:t}=Object(n.useContext)(m);return l.a.createElement("nav",{className:"navbar"},l.a.createElement("div",{className:"navbar-links"},e&&l.a.createElement(l.a.Fragment,null,l.a.createElement(o.b,{to:"/invoices",className:"navbar-link"},"Invoices"),"admin"===(null===e||void 0===e?void 0:e.role)&&l.a.createElement(o.b,{to:"/users",className:"navbar-link"},"User Management"),l.a.createElement("button",{onClick:()=>{localStorage.removeItem("user"),t(null),window.location.href="/login"},className:"navbar-button"},"Logout")),!e&&l.a.createElement(o.b,{to:"/login",className:"navbar-link"},"Login")))};var b=()=>{const[e,t]=Object(n.useState)(null);return Object(n.useEffect)(()=>{const e=localStorage.getItem("user");e&&t(JSON.parse(e))},[]),l.a.createElement(m.Provider,{value:{user:e,setUser:t}},l.a.createElement(o.a,null,l.a.createElement(y,null),l.a.createElement(s.d,null,l.a.createElement(s.b,{path:"/",element:e?l.a.createElement(s.a,{to:"/invoices"}):l.a.createElement(u,{setUser:t})}),l.a.createElement(s.b,{path:"/invoices",element:e?l.a.createElement(E,{allowedRoles:["admin","editor","viewer"]},l.a.createElement(p,null)):l.a.createElement(s.a,{to:"/"})}),l.a.createElement(s.b,{path:"/users",element:e?l.a.createElement(E,{allowedRoles:["admin"]},l.a.createElement(v,null)):l.a.createElement(s.a,{to:"/"})}))))};var h=e=>{e&&e instanceof Function&&a.e(3).then(a.bind(null,33)).then(t=>{let{getCLS:a,getFID:n,getFCP:l,getLCP:c,getTTFB:r}=t;a(e),n(e),l(e),c(e),r(e)})};r.a.createRoot(document.getElementById("root")).render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(b,null))),h()}},[[15,1,2]]]);
//# sourceMappingURL=main.879ff262.chunk.js.map